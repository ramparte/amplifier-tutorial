<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Hooks - Amplifier Tutorial</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Hooks";
        var mkdocs_page_input_path = "concepts/hooks.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/python.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/bash.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Amplifier Tutorial
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Getting Started</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../quickstart/index.html">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../quickstart/what-is-amplifier.html">What is Amplifier?</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../quickstart/how-its-different.html">How It's Different</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../quickstart/installation.html">Installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../quickstart/first-conversation.html">Your First Conversation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../quickstart/key-commands.html">Key Commands</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../quickstart/first-bundle.html">Your First Bundle</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Core Concepts</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture Deep Dive</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="modules.html">Modules</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="bundles.html">Bundles</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="agents.html">Agents</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="recipes.html">Recipes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="skills.html">Skills</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="hooks.html">Hooks</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#what-is-a-hook">What is a Hook?</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#key-characteristics">Key Characteristics</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#hook-vs-tool">Hook vs Tool</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#event-types">Event Types</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#session-events">Session Events</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#message-events">Message Events</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#tool-events">Tool Events</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#llm-events">LLM Events</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#built-in-hooks">Built-in Hooks</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#consolelogginghook">ConsoleLoggingHook</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#metricshook">MetricsHook</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fileaudithook">FileAuditHook</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#webhooknotifierhook">WebhookNotifierHook</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#creating-hooks">Creating Hooks</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#basic-hook-structure">Basic Hook Structure</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#registering-hooks">Registering Hooks</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#hook-context">Hook Context</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#best-practices">Best Practices</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#key-takeaways">Key Takeaways</a>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Tools Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tools/filesystem.html">Filesystem</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tools/bash.html">Bash</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tools/search.html">Search (grep & glob)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tools/web.html">Web Tools</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tools/task.html">Task (Sub-Agents)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tools/lsp.html">LSP (Code Intelligence)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tools/recipes-tool.html">Recipes Tool</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Bundles Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../bundles/index.html">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../bundles/foundation.html">Foundation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../bundles/recipes.html">Recipes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../bundles/lsp-python.html">LSP Python</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../bundles/design-intelligence.html">Design Intelligence</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Skills Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../skills/index.html">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../skills/playwright.html">Playwright</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../skills/curl.html">Curl</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../skills/image-vision.html">Image Vision</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Developer Setup</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../dev-setup/index.html">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dev-setup/cli-tools.html">CLI Tools</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dev-setup/shadow-workspace.html">Shadow Workspace</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dev-setup/remote-dev.html">Remote Development</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dev-setup/debugging.html">Debugging</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Advanced</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../advanced/index.html">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../advanced/custom-bundle.html">Custom Bundles</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../advanced/custom-tool.html">Custom Tools</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../advanced/custom-recipe.html">Custom Recipes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../advanced/mcp-integration.html">MCP Integration</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Amplifier Tutorial</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Core Concepts</li>
      <li class="breadcrumb-item active">Hooks</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="understanding-hooks">Understanding Hooks<a class="headerlink" href="#understanding-hooks" title="Permanent link">&para;</a></h1>
<p>Hooks are the observation layer of the Amplifier ecosystem. They allow you to monitor, react to, and extend agent behavior without modifying core logic. Think of hooks as event listeners that tap into the agent lifecycle at specific points.</p>
<h2 id="what-is-a-hook">What is a Hook?<a class="headerlink" href="#what-is-a-hook" title="Permanent link">&para;</a></h2>
<p>A hook is a lifecycle observer that receives notifications about events occurring during agent execution. Unlike tools that perform actions, hooks observe and react to what's already happening.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">amplifier</span> <span class="kn">import</span> <span class="n">Hook</span><span class="p">,</span> <span class="n">HookContext</span>

<span class="k">class</span> <span class="nc">LoggingHook</span><span class="p">(</span><span class="n">Hook</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simple hook that logs all events.&quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">on_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">HookContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">ctx</span><span class="o">.</span><span class="n">event_type</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">ctx</span><span class="o">.</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">ctx</span><span class="o">.</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<p>Hooks are passive by design. They receive event data, can perform side effects (logging, metrics, notifications), but they don't modify the agent's execution flow. This separation keeps your agent logic clean while enabling rich observability.</p>
<h3 id="key-characteristics">Key Characteristics<a class="headerlink" href="#key-characteristics" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Non-blocking</strong>: Hooks should complete quickly to avoid slowing the agent</li>
<li><strong>Read-only context</strong>: Hooks observe events but don't modify them</li>
<li><strong>Fail-safe</strong>: Hook failures don't crash the agent</li>
<li><strong>Ordered execution</strong>: Multiple hooks run in registration order</li>
</ul>
<h2 id="hook-vs-tool">Hook vs Tool<a class="headerlink" href="#hook-vs-tool" title="Permanent link">&para;</a></h2>
<p>Understanding the difference between hooks and tools is fundamental:</p>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Hook</th>
<th>Tool</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Purpose</strong></td>
<td>Observe and react</td>
<td>Perform actions</td>
</tr>
<tr>
<td><strong>Invocation</strong></td>
<td>Automatic on events</td>
<td>Explicit by agent</td>
</tr>
<tr>
<td><strong>Modifies state</strong></td>
<td>No (observation only)</td>
<td>Yes (side effects expected)</td>
</tr>
<tr>
<td><strong>Blocking</strong></td>
<td>Should be fast</td>
<td>Can be long-running</td>
</tr>
<tr>
<td><strong>Failure impact</strong></td>
<td>Logged, continues</td>
<td>Reported to agent</td>
</tr>
</tbody>
</table>
<p><strong>Use a hook when you want to:</strong>
- Log or audit agent activity
- Collect metrics and telemetry
- Send notifications on specific events
- Validate or monitor behavior patterns</p>
<p><strong>Use a tool when you need to:</strong>
- Perform an action the agent requests
- Return data the agent will use
- Modify external state
- Execute long-running operations</p>
<h2 id="event-types">Event Types<a class="headerlink" href="#event-types" title="Permanent link">&para;</a></h2>
<p>Hooks subscribe to specific event types that occur during the agent lifecycle:</p>
<h3 id="session-events">Session Events<a class="headerlink" href="#session-events" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">SessionEvents</span><span class="p">:</span>
    <span class="n">SESSION_START</span> <span class="o">=</span> <span class="s2">&quot;session.start&quot;</span>      <span class="c1"># Agent session begins</span>
    <span class="n">SESSION_END</span> <span class="o">=</span> <span class="s2">&quot;session.end&quot;</span>          <span class="c1"># Agent session completes</span>
    <span class="n">SESSION_ERROR</span> <span class="o">=</span> <span class="s2">&quot;session.error&quot;</span>      <span class="c1"># Unhandled error in session</span>
</code></pre></div>

<h3 id="message-events">Message Events<a class="headerlink" href="#message-events" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">MessageEvents</span><span class="p">:</span>
    <span class="n">USER_MESSAGE</span> <span class="o">=</span> <span class="s2">&quot;message.user&quot;</span>        <span class="c1"># User sends a message</span>
    <span class="n">ASSISTANT_MESSAGE</span> <span class="o">=</span> <span class="s2">&quot;message.assistant&quot;</span>  <span class="c1"># Agent responds</span>
    <span class="n">SYSTEM_MESSAGE</span> <span class="o">=</span> <span class="s2">&quot;message.system&quot;</span>    <span class="c1"># System injects context</span>
</code></pre></div>

<h3 id="tool-events">Tool Events<a class="headerlink" href="#tool-events" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">ToolEvents</span><span class="p">:</span>
    <span class="n">TOOL_CALL</span> <span class="o">=</span> <span class="s2">&quot;tool.call&quot;</span>              <span class="c1"># Agent invokes a tool</span>
    <span class="n">TOOL_RESULT</span> <span class="o">=</span> <span class="s2">&quot;tool.result&quot;</span>          <span class="c1"># Tool returns a result</span>
    <span class="n">TOOL_ERROR</span> <span class="o">=</span> <span class="s2">&quot;tool.error&quot;</span>            <span class="c1"># Tool execution fails</span>
</code></pre></div>

<h3 id="llm-events">LLM Events<a class="headerlink" href="#llm-events" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">LLMEvents</span><span class="p">:</span>
    <span class="n">LLM_REQUEST</span> <span class="o">=</span> <span class="s2">&quot;llm.request&quot;</span>          <span class="c1"># Request sent to LLM</span>
    <span class="n">LLM_RESPONSE</span> <span class="o">=</span> <span class="s2">&quot;llm.response&quot;</span>        <span class="c1"># Response received from LLM</span>
    <span class="n">LLM_STREAM_CHUNK</span> <span class="o">=</span> <span class="s2">&quot;llm.stream&quot;</span>      <span class="c1"># Streaming chunk received</span>
</code></pre></div>

<h2 id="built-in-hooks">Built-in Hooks<a class="headerlink" href="#built-in-hooks" title="Permanent link">&para;</a></h2>
<p>Amplifier provides several hooks out of the box for common observability needs:</p>
<h3 id="consolelogginghook">ConsoleLoggingHook<a class="headerlink" href="#consolelogginghook" title="Permanent link">&para;</a></h3>
<p>Logs all events to the console with configurable verbosity:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">amplifier.hooks</span> <span class="kn">import</span> <span class="n">ConsoleLoggingHook</span>

<span class="n">hook</span> <span class="o">=</span> <span class="n">ConsoleLoggingHook</span><span class="p">(</span>
    <span class="n">level</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
    <span class="n">include_events</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;tool.call&quot;</span><span class="p">,</span> <span class="s2">&quot;tool.result&quot;</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="metricshook">MetricsHook<a class="headerlink" href="#metricshook" title="Permanent link">&para;</a></h3>
<p>Collects timing and count metrics for analysis:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">amplifier.hooks</span> <span class="kn">import</span> <span class="n">MetricsHook</span>

<span class="n">hook</span> <span class="o">=</span> <span class="n">MetricsHook</span><span class="p">()</span>

<span class="c1"># After session, access metrics</span>
<span class="nb">print</span><span class="p">(</span><span class="n">hook</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">tool_call_count</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">hook</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">avg_response_time</span><span class="p">)</span>
</code></pre></div>

<h3 id="fileaudithook">FileAuditHook<a class="headerlink" href="#fileaudithook" title="Permanent link">&para;</a></h3>
<p>Writes a complete audit trail to a file:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">amplifier.hooks</span> <span class="kn">import</span> <span class="n">FileAuditHook</span>

<span class="n">hook</span> <span class="o">=</span> <span class="n">FileAuditHook</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;./logs/session-</span><span class="si">{session_id}</span><span class="s2">.jsonl&quot;</span><span class="p">,</span>
    <span class="n">include_content</span><span class="o">=</span><span class="kc">True</span>  <span class="c1"># Include full message content</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="webhooknotifierhook">WebhookNotifierHook<a class="headerlink" href="#webhooknotifierhook" title="Permanent link">&para;</a></h3>
<p>Sends HTTP notifications on specific events:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">amplifier.hooks</span> <span class="kn">import</span> <span class="n">WebhookNotifierHook</span>

<span class="n">hook</span> <span class="o">=</span> <span class="n">WebhookNotifierHook</span><span class="p">(</span>
    <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://api.example.com/events&quot;</span><span class="p">,</span>
    <span class="n">events</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;session.end&quot;</span><span class="p">,</span> <span class="s2">&quot;tool.error&quot;</span><span class="p">],</span>
    <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer token&quot;</span><span class="p">}</span>
<span class="p">)</span>
</code></pre></div>

<h2 id="creating-hooks">Creating Hooks<a class="headerlink" href="#creating-hooks" title="Permanent link">&para;</a></h2>
<p>Building custom hooks is straightforward. Extend the base <code>Hook</code> class and implement the methods you need:</p>
<h3 id="basic-hook-structure">Basic Hook Structure<a class="headerlink" href="#basic-hook-structure" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">amplifier</span> <span class="kn">import</span> <span class="n">Hook</span><span class="p">,</span> <span class="n">HookContext</span>

<span class="k">class</span> <span class="nc">MyCustomHook</span><span class="p">(</span><span class="n">Hook</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A custom hook with selective event handling.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">subscribed_events</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Specify which events this hook receives.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;tool.call&quot;</span><span class="p">,</span> <span class="s2">&quot;tool.result&quot;</span><span class="p">,</span> <span class="s2">&quot;session.end&quot;</span><span class="p">]</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">on_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">HookContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle incoming events.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;tool.call&quot;</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_tool_call</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ctx</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;session.end&quot;</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_session_end</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_handle_tool_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">HookContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tool_name</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tool_name&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tool called: </span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_handle_session_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">HookContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Session ended. Total events observed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">event_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="registering-hooks">Registering Hooks<a class="headerlink" href="#registering-hooks" title="Permanent link">&para;</a></h3>
<p>Register hooks when configuring your agent:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">amplifier</span> <span class="kn">import</span> <span class="n">Agent</span>

<span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span>
    <span class="n">hooks</span><span class="o">=</span><span class="p">[</span>
        <span class="n">ConsoleLoggingHook</span><span class="p">(),</span>
        <span class="n">MyCustomHook</span><span class="p">({</span><span class="s2">&quot;verbose&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}),</span>
        <span class="n">MetricsHook</span><span class="p">()</span>
    <span class="p">]</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="hook-context">Hook Context<a class="headerlink" href="#hook-context" title="Permanent link">&para;</a></h3>
<p>The <code>HookContext</code> object provides rich information about each event:</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">HookContext</span><span class="p">:</span>
    <span class="n">event_type</span><span class="p">:</span> <span class="nb">str</span>          <span class="c1"># The event type (e.g., &quot;tool.call&quot;)</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="n">datetime</span>      <span class="c1"># When the event occurred</span>
    <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span>          <span class="c1"># Current session identifier</span>
    <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span>               <span class="c1"># Event-specific payload</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span>           <span class="c1"># Additional context (user_id, etc.)</span>
</code></pre></div>

<h3 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Keep hooks fast</strong>: Offload heavy work to background tasks</li>
<li><strong>Handle errors gracefully</strong>: Don't let hook failures affect the agent</li>
<li><strong>Be selective</strong>: Subscribe only to events you need</li>
<li><strong>Use async patterns</strong>: Leverage async for I/O operations</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">on_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">HookContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Quick validation</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_process</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># Offload heavy work</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_async</span><span class="p">(</span><span class="n">ctx</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Log but don&#39;t raise</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hook error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h2 id="key-takeaways">Key Takeaways<a class="headerlink" href="#key-takeaways" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p><strong>Hooks are observers</strong>: They watch the agent lifecycle without modifying it. Use them for logging, metrics, notifications, and auditing.</p>
</li>
<li>
<p><strong>Hooks complement tools</strong>: While tools perform actions for the agent, hooks monitor what's happening. Both are essential for production systems.</p>
</li>
<li>
<p><strong>Event types are granular</strong>: Subscribe to specific events like <code>tool.call</code> or <code>session.end</code> rather than receiving everything.</p>
</li>
<li>
<p><strong>Built-in hooks cover common cases</strong>: Use <code>ConsoleLoggingHook</code>, <code>MetricsHook</code>, and <code>FileAuditHook</code> before building custom solutions.</p>
</li>
<li>
<p><strong>Custom hooks are simple</strong>: Extend <code>Hook</code>, specify <code>subscribed_events</code>, and implement <code>on_event</code>. Keep them fast and error-tolerant.</p>
</li>
<li>
<p><strong>Observability enables reliability</strong>: Hooks provide the visibility needed to debug, optimize, and trust your agent systems in production.</p>
</li>
</ol>
<p>Hooks transform opaque agent execution into transparent, observable systems. Start with built-in hooks to understand behavior, then create custom hooks as your monitoring needs evolve.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="skills.html" class="btn btn-neutral float-left" title="Skills"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../tools/index.html" class="btn btn-neutral float-right" title="Overview">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="skills.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../tools/index.html" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
