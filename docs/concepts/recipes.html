<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Recipes - Amplifier Tutorial</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Recipes";
        var mkdocs_page_input_path = "concepts/recipes.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/python.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/bash.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> Amplifier Tutorial
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Getting Started</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../quickstart/index.html">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../quickstart/what-is-amplifier.html">What is Amplifier?</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../quickstart/how-its-different.html">How It's Different</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../quickstart/installation.html">Installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../quickstart/first-conversation.html">Your First Conversation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../quickstart/key-commands.html">Key Commands</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../quickstart/first-bundle.html">Your First Bundle</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Core Concepts</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="index.html">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture Deep Dive</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="modules.html">Modules</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="bundles.html">Bundles</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="agents.html">Agents</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="recipes.html">Recipes</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#what-is-a-recipe">What is a Recipe?</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#a-simple-example">A Simple Example</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#when-to-use-recipes">When to Use Recipes</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#reproducible-workflows">Reproducible Workflows</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#complex-multi-step-tasks">Complex Multi-Step Tasks</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#tasks-requiring-human-oversight">Tasks Requiring Human Oversight</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#collaborative-workflows">Collaborative Workflows</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#recipe-structure">Recipe Structure</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#required-elements">Required Elements</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#optional-elements">Optional Elements</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#flat-vs-staged-recipes">Flat vs. Staged Recipes</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#steps-and-context">Steps and Context</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-anatomy">Step Anatomy</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#context-flow">Context Flow</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#template-syntax">Template Syntax</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#advanced-context-features">Advanced Context Features</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#approval-gates">Approval Gates</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#defining-approval-gates">Defining Approval Gates</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#managing-approvals">Managing Approvals</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#approval-metadata">Approval Metadata</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#best-practices-for-approval-gates">Best Practices for Approval Gates</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#recipe-operations">Recipe Operations</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#execution-example">Execution Example</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#error-handling">Error Handling</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-level-error-handling">Step-Level Error Handling</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#error-strategies">Error Strategies</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#accessing-error-information">Accessing Error Information</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#key-takeaways">Key Takeaways</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="skills.html">Skills</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="hooks.html">Hooks</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Tools Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tools/filesystem.html">Filesystem</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tools/bash.html">Bash</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tools/search.html">Search (grep & glob)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tools/web.html">Web Tools</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tools/task.html">Task (Sub-Agents)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tools/lsp.html">LSP (Code Intelligence)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tools/recipes-tool.html">Recipes Tool</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Bundles Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../bundles/index.html">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../bundles/foundation.html">Foundation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../bundles/recipes.html">Recipes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../bundles/lsp-python.html">LSP Python</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../bundles/design-intelligence.html">Design Intelligence</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Skills Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../skills/index.html">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../skills/playwright.html">Playwright</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../skills/curl.html">Curl</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../skills/image-vision.html">Image Vision</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Developer Setup</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../dev-setup/index.html">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dev-setup/cli-tools.html">CLI Tools</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dev-setup/shadow-workspace.html">Shadow Workspace</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dev-setup/remote-dev.html">Remote Development</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dev-setup/debugging.html">Debugging</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Advanced</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../advanced/index.html">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../advanced/custom-bundle.html">Custom Bundles</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../advanced/custom-tool.html">Custom Tools</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../advanced/custom-recipe.html">Custom Recipes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../advanced/mcp-integration.html">MCP Integration</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Amplifier Tutorial</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Core Concepts</li>
      <li class="breadcrumb-item active">Recipes</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="understanding-recipes">Understanding Recipes<a class="headerlink" href="#understanding-recipes" title="Permanent link">&para;</a></h1>
<p>Recipes are declarative YAML specifications that define multi-step agent workflows. They allow you to orchestrate complex tasks by breaking them into sequential steps, each potentially delegating to different agents. Recipes provide structure, reproducibility, and human oversight for AI-driven processes.</p>
<h2 id="what-is-a-recipe">What is a Recipe?<a class="headerlink" href="#what-is-a-recipe" title="Permanent link">&para;</a></h2>
<p>A Recipe is a blueprint for agent orchestration. Rather than manually invoking agents step-by-step, you define the entire workflow upfront in a YAML file. The recipe executor then handles:</p>
<ul>
<li><strong>Sequential execution</strong> - Steps run in order, with each step's output available to subsequent steps</li>
<li><strong>State persistence</strong> - Context accumulates across steps, building a shared understanding</li>
<li><strong>Automatic checkpointing</strong> - Sessions can be resumed if interrupted</li>
<li><strong>Error handling</strong> - Built-in retry logic and failure management</li>
<li><strong>Approval gates</strong> - Human-in-the-loop checkpoints for critical decisions</li>
</ul>
<p>Think of recipes as the difference between giving verbal instructions one at a time versus handing someone a complete written procedure. Both accomplish the goal, but the written procedure is reproducible, auditable, and can be improved over time.</p>
<h3 id="a-simple-example">A Simple Example<a class="headerlink" href="#a-simple-example" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">code-review</span>
<span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Review code changes and suggest improvements</span>

<span class="nt">steps</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">analyze</span>
<span class="w">    </span><span class="nt">agent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foundation:explorer</span>
<span class="w">    </span><span class="nt">instruction</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">Analyze the code in {{ file_path }}.</span>
<span class="w">      </span><span class="no">Identify the main purpose, structure, and any patterns used.</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">review</span>
<span class="w">    </span><span class="nt">agent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foundation:zen-architect</span>
<span class="w">    </span><span class="nt">instruction</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">Based on the analysis:</span>
<span class="w">      </span><span class="no">{{ steps.analyze.result }}</span>

<span class="w">      </span><span class="no">Review this code for:</span>
<span class="w">      </span><span class="no">- Adherence to simplicity principles</span>
<span class="w">      </span><span class="no">- Potential bugs or edge cases</span>
<span class="w">      </span><span class="no">- Opportunities for improvement</span>
</code></pre></div>

<p>This recipe defines two steps: first exploring the code structure, then reviewing it with architectural expertise. The second step receives the output of the first through template variables.</p>
<h2 id="when-to-use-recipes">When to Use Recipes<a class="headerlink" href="#when-to-use-recipes" title="Permanent link">&para;</a></h2>
<p>Recipes excel in scenarios where you need:</p>
<h3 id="reproducible-workflows">Reproducible Workflows<a class="headerlink" href="#reproducible-workflows" title="Permanent link">&para;</a></h3>
<p>When you find yourself repeatedly performing the same multi-agent task, a recipe captures that process. Instead of remembering which agents to invoke and in what order, you run the recipe and get consistent results.</p>
<p><strong>Examples:</strong>
- Code review pipelines
- Documentation generation
- Release preparation checklists
- Security audits</p>
<h3 id="complex-multi-step-tasks">Complex Multi-Step Tasks<a class="headerlink" href="#complex-multi-step-tasks" title="Permanent link">&para;</a></h3>
<p>Some tasks naturally decompose into phases that build on each other. Recipes make these dependencies explicit and ensure proper sequencing.</p>
<p><strong>Examples:</strong>
- Feature implementation (design → implement → test → document)
- Bug investigation (reproduce → analyze → fix → verify)
- Migration tasks (assess → plan → execute → validate)</p>
<h3 id="tasks-requiring-human-oversight">Tasks Requiring Human Oversight<a class="headerlink" href="#tasks-requiring-human-oversight" title="Permanent link">&para;</a></h3>
<p>When certain decisions shouldn't be fully automated, recipes support approval gates. Execution pauses until a human reviews and approves (or rejects) continuing.</p>
<p><strong>Examples:</strong>
- Production deployments
- Security-sensitive changes
- Decisions with significant business impact</p>
<h3 id="collaborative-workflows">Collaborative Workflows<a class="headerlink" href="#collaborative-workflows" title="Permanent link">&para;</a></h3>
<p>Recipes create a shared understanding between team members. Anyone can run the recipe and understand exactly what steps will be taken, making handoffs and reviews straightforward.</p>
<h2 id="recipe-structure">Recipe Structure<a class="headerlink" href="#recipe-structure" title="Permanent link">&para;</a></h2>
<p>Every recipe follows a consistent structure with required and optional elements.</p>
<h3 id="required-elements">Required Elements<a class="headerlink" href="#required-elements" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-workflow</span><span class="w">          </span><span class="c1"># Unique identifier for the recipe</span>
<span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">What it does</span><span class="w">  </span><span class="c1"># Human-readable description</span>

<span class="nt">steps</span><span class="p">:</span><span class="w">                     </span><span class="c1"># List of steps to execute</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">step-one</span><span class="w">           </span><span class="c1"># Unique step identifier</span>
<span class="w">    </span><span class="nt">agent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">agent:name</span><span class="w">      </span><span class="c1"># Agent to invoke</span>
<span class="w">    </span><span class="nt">instruction</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w">         </span><span class="c1"># Task for the agent</span>
<span class="w">      </span><span class="no">What to do...</span>
</code></pre></div>

<h3 id="optional-elements">Optional Elements<a class="headerlink" href="#optional-elements" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Context variables (can be overridden at execution time)</span>
<span class="nt">context</span><span class="p">:</span>
<span class="w">  </span><span class="nt">default_branch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">staging</span>

<span class="c1"># Global settings</span>
<span class="nt">settings</span><span class="p">:</span>
<span class="w">  </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">300</span><span class="w">             </span><span class="c1"># Default timeout per step (seconds)</span>
<span class="w">  </span><span class="nt">retry_count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w">           </span><span class="c1"># Default retry attempts on failure</span>

<span class="c1"># Step-level options</span>
<span class="nt">steps</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example</span>
<span class="w">    </span><span class="nt">agent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foundation:explorer</span>
<span class="w">    </span><span class="nt">instruction</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Explore the codebase</span>
<span class="w">    </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">600</span><span class="w">           </span><span class="c1"># Override default timeout</span>
<span class="w">    </span><span class="nt">retry_count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w">         </span><span class="c1"># Override default retries</span>
<span class="w">    </span><span class="nt">on_error</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">continue</span><span class="w">     </span><span class="c1"># continue, fail, or skip</span>
</code></pre></div>

<h3 id="flat-vs-staged-recipes">Flat vs. Staged Recipes<a class="headerlink" href="#flat-vs-staged-recipes" title="Permanent link">&para;</a></h3>
<p>Recipes come in two flavors:</p>
<p><strong>Flat recipes</strong> execute all steps sequentially without pause:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">simple-task</span>
<span class="nt">steps</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">step-one</span>
<span class="w">    </span><span class="nt">agent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foundation:explorer</span>
<span class="w">    </span><span class="nt">instruction</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">First task</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">step-two</span>
<span class="w">    </span><span class="nt">agent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foundation:file-ops</span>
<span class="w">    </span><span class="nt">instruction</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Second task</span>
</code></pre></div>

<p><strong>Staged recipes</strong> group steps into stages with approval gates between them:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">careful-deployment</span>
<span class="nt">stages</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">planning</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">analyze</span>
<span class="w">        </span><span class="nt">agent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foundation:zen-architect</span>
<span class="w">        </span><span class="nt">instruction</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Plan the deployment</span>
<span class="w">    </span><span class="nt">requires_approval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">execution</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
<span class="w">        </span><span class="nt">agent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foundation:modular-builder</span>
<span class="w">        </span><span class="nt">instruction</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Execute the deployment plan</span>
</code></pre></div>

<h2 id="steps-and-context">Steps and Context<a class="headerlink" href="#steps-and-context" title="Permanent link">&para;</a></h2>
<p>Steps are the fundamental units of a recipe. Each step invokes an agent with specific instructions and can access accumulated context from previous steps.</p>
<h3 id="step-anatomy">Step Anatomy<a class="headerlink" href="#step-anatomy" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="nt">steps</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unique-identifier</span><span class="w">    </span><span class="c1"># Required: referenced by other steps</span>
<span class="w">    </span><span class="nt">agent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bundle:agent-name</span><span class="w"> </span><span class="c1"># Required: which agent to use</span>
<span class="w">    </span><span class="nt">instruction</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w">           </span><span class="c1"># Required: what to do</span>
<span class="w">      </span><span class="no">Detailed instructions for the agent.</span>
<span class="w">      </span><span class="no">Can span multiple lines.</span>

<span class="w">    </span><span class="c1"># Optional fields</span>
<span class="w">    </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">300</span><span class="w">             </span><span class="c1"># Seconds before timeout</span>
<span class="w">    </span><span class="nt">retry_count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w">           </span><span class="c1"># Retries on failure</span>
<span class="w">    </span><span class="nt">on_error</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fail</span><span class="w">           </span><span class="c1"># fail, continue, or skip</span>
<span class="w">    </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">steps.previous.success</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="w">  </span><span class="c1"># Conditional execution</span>
</code></pre></div>

<h3 id="context-flow">Context Flow<a class="headerlink" href="#context-flow" title="Permanent link">&para;</a></h3>
<p>Context flows through recipes in two ways:</p>
<p><strong>1. Explicit context variables</strong> - Defined at recipe level or passed at execution:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">context</span><span class="p">:</span>
<span class="w">  </span><span class="nt">project_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-app</span>
<span class="w">  </span><span class="nt">target_branch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>

<span class="nt">steps</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">setup</span>
<span class="w">    </span><span class="nt">agent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foundation:file-ops</span>
<span class="w">    </span><span class="nt">instruction</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">Working on project: {{ project_name }}</span>
<span class="w">      </span><span class="no">Target branch: {{ target_branch }}</span>
</code></pre></div>

<p><strong>2. Step results</strong> - Output from previous steps:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">steps</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">discover</span>
<span class="w">    </span><span class="nt">agent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foundation:explorer</span>
<span class="w">    </span><span class="nt">instruction</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Find all Python files in src/</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">analyze</span>
<span class="w">    </span><span class="nt">agent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lsp-python:python-code-intel</span>
<span class="w">    </span><span class="nt">instruction</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">Analyze these files:</span>
<span class="w">      </span><span class="no">{{ steps.discover.result }}</span>
</code></pre></div>

<h3 id="template-syntax">Template Syntax<a class="headerlink" href="#template-syntax" title="Permanent link">&para;</a></h3>
<p>Recipes use Jinja2-style templates for variable interpolation:</p>
<table>
<thead>
<tr>
<th>Pattern</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>{{ variable }}</code></td>
<td>Insert a context variable</td>
</tr>
<tr>
<td><code>{{ steps.id.result }}</code></td>
<td>Insert a step's result</td>
</tr>
<tr>
<td><code>{{ steps.id.success }}</code></td>
<td>Boolean: did the step succeed?</td>
</tr>
<tr>
<td><code>{% if condition %}...{% endif %}</code></td>
<td>Conditional content</td>
</tr>
<tr>
<td><code>{% for item in list %}...{% endfor %}</code></td>
<td>Loop over items</td>
</tr>
</tbody>
</table>
<h3 id="advanced-context-features">Advanced Context Features<a class="headerlink" href="#advanced-context-features" title="Permanent link">&para;</a></h3>
<p><strong>Foreach loops</strong> execute a step multiple times:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">steps</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">review-each</span>
<span class="w">    </span><span class="nt">agent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foundation:zen-architect</span>
<span class="w">    </span><span class="nt">foreach</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">files</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">instruction</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">Review the file: {{ item }}</span>
</code></pre></div>

<p><strong>Conditional execution</strong> skips steps based on conditions:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">steps</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy-prod</span>
<span class="w">    </span><span class="nt">agent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foundation:modular-builder</span>
<span class="w">    </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">environment</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&#39;production&#39;</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">instruction</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy to production servers</span>
</code></pre></div>

<h2 id="approval-gates">Approval Gates<a class="headerlink" href="#approval-gates" title="Permanent link">&para;</a></h2>
<p>Approval gates pause recipe execution until a human approves or denies continuation. They provide critical oversight for high-stakes workflows.</p>
<h3 id="defining-approval-gates">Defining Approval Gates<a class="headerlink" href="#defining-approval-gates" title="Permanent link">&para;</a></h3>
<p>In staged recipes, add <code>requires_approval: true</code> to a stage:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">stages</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">analysis</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">security-scan</span>
<span class="w">        </span><span class="nt">agent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foundation:security-guardian</span>
<span class="w">        </span><span class="nt">instruction</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Scan for vulnerabilities</span>
<span class="w">    </span><span class="nt">requires_approval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">approval_message</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">Security scan complete. Review findings before proceeding.</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deployment</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
<span class="w">        </span><span class="nt">agent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foundation:modular-builder</span>
<span class="w">        </span><span class="nt">instruction</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy the application</span>
</code></pre></div>

<h3 id="managing-approvals">Managing Approvals<a class="headerlink" href="#managing-approvals" title="Permanent link">&para;</a></h3>
<p>When a recipe reaches an approval gate, it pauses and waits. You can manage pending approvals:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># List all pending approvals</span>
<span class="l l-Scalar l-Scalar-Plain">recipes operation=approvals</span>

<span class="l l-Scalar l-Scalar-Plain"># Approve a stage to continue</span>
<span class="l l-Scalar l-Scalar-Plain">recipes operation=approve session_id=xxx stage_name=analysis</span>

<span class="l l-Scalar l-Scalar-Plain"># Deny a stage (stops execution)</span>
<span class="l l-Scalar l-Scalar-Plain">recipes operation=deny session_id=xxx stage_name=analysis reason=&quot;Found critical vulnerability&quot;</span>
</code></pre></div>

<h3 id="approval-metadata">Approval Metadata<a class="headerlink" href="#approval-metadata" title="Permanent link">&para;</a></h3>
<p>When approving, you can include metadata that becomes available to subsequent steps:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># The approval context is available in later steps</span>
<span class="nt">steps</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">post-approval</span>
<span class="w">    </span><span class="nt">agent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foundation:modular-builder</span>
<span class="w">    </span><span class="nt">instruction</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">Approval notes: {{ approval.notes }}</span>
<span class="w">      </span><span class="no">Approved by: {{ approval.user }}</span>
</code></pre></div>

<h3 id="best-practices-for-approval-gates">Best Practices for Approval Gates<a class="headerlink" href="#best-practices-for-approval-gates" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Include clear context</strong> - The approval message should summarize what was done and what will happen next</li>
<li><strong>Use sparingly</strong> - Too many gates slow workflows; reserve for genuinely critical checkpoints</li>
<li><strong>Provide actionable information</strong> - Include links, summaries, or specific items to review</li>
<li><strong>Consider timeouts</strong> - Long-pending approvals may indicate a stale workflow</li>
</ol>
<h2 id="recipe-operations">Recipe Operations<a class="headerlink" href="#recipe-operations" title="Permanent link">&para;</a></h2>
<p>The recipe system supports several operations:</p>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>execute</code></td>
<td>Run a recipe from a YAML file</td>
</tr>
<tr>
<td><code>resume</code></td>
<td>Continue an interrupted session</td>
</tr>
<tr>
<td><code>list</code></td>
<td>Show active recipe sessions</td>
</tr>
<tr>
<td><code>validate</code></td>
<td>Check recipe structure without running</td>
</tr>
<tr>
<td><code>approvals</code></td>
<td>List pending approvals</td>
</tr>
<tr>
<td><code>approve</code></td>
<td>Approve a pending stage</td>
</tr>
<tr>
<td><code>deny</code></td>
<td>Deny a pending stage</td>
</tr>
</tbody>
</table>
<h3 id="execution-example">Execution Example<a class="headerlink" href="#execution-example" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Execute a recipe with context</span>
<span class="l l-Scalar l-Scalar-Plain">recipes operation=execute recipe_path=review.yaml context={&quot;file_path&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;src/main.py&quot;</span><span class="err">}</span>

<span class="c1"># Resume an interrupted session</span>
<span class="l l-Scalar l-Scalar-Plain">recipes operation=resume session_id=recipe_20260110_143022_a3f2</span>

<span class="c1"># Validate before running</span>
<span class="l l-Scalar l-Scalar-Plain">recipes operation=validate recipe_path=new-recipe.yaml</span>
</code></pre></div>

<h2 id="error-handling">Error Handling<a class="headerlink" href="#error-handling" title="Permanent link">&para;</a></h2>
<p>Recipes provide flexible error handling at multiple levels:</p>
<h3 id="step-level-error-handling">Step-Level Error Handling<a class="headerlink" href="#step-level-error-handling" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="nt">steps</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">risky-operation</span>
<span class="w">    </span><span class="nt">agent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foundation:integration-specialist</span>
<span class="w">    </span><span class="nt">instruction</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Call external API</span>
<span class="w">    </span><span class="nt">retry_count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w">           </span><span class="c1"># Retry up to 3 times</span>
<span class="w">    </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60</span><span class="w">              </span><span class="c1"># Timeout after 60 seconds</span>
<span class="w">    </span><span class="nt">on_error</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">continue</span><span class="w">       </span><span class="c1"># Don&#39;t fail the whole recipe</span>
</code></pre></div>

<h3 id="error-strategies">Error Strategies<a class="headerlink" href="#error-strategies" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Strategy</th>
<th>Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fail</code></td>
<td>Stop the recipe immediately (default)</td>
</tr>
<tr>
<td><code>continue</code></td>
<td>Log the error and proceed to next step</td>
</tr>
<tr>
<td><code>skip</code></td>
<td>Skip dependent steps and continue</td>
</tr>
</tbody>
</table>
<h3 id="accessing-error-information">Accessing Error Information<a class="headerlink" href="#accessing-error-information" title="Permanent link">&para;</a></h3>
<p>Failed steps provide error context:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">steps</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">handle-failure</span>
<span class="w">    </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">steps.risky-operation.success</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">agent</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foundation:bug-hunter</span>
<span class="w">    </span><span class="nt">instruction</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">The previous step failed with:</span>
<span class="w">      </span><span class="no">{{ steps.risky-operation.error }}</span>

<span class="w">      </span><span class="no">Investigate and suggest fixes.</span>
</code></pre></div>

<h2 id="key-takeaways">Key Takeaways<a class="headerlink" href="#key-takeaways" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p><strong>Recipes are declarative workflows</strong> - Define what should happen, not how to orchestrate it manually</p>
</li>
<li>
<p><strong>Steps build on each other</strong> - Each step can access results from previous steps through template variables</p>
</li>
<li>
<p><strong>Two flavors exist</strong> - Flat recipes for simple sequences, staged recipes for workflows needing approval gates</p>
</li>
<li>
<p><strong>Context flows automatically</strong> - Variables and results accumulate, giving later steps full awareness of earlier work</p>
</li>
<li>
<p><strong>Approval gates enable oversight</strong> - Pause execution at critical points for human review and decision-making</p>
</li>
<li>
<p><strong>Error handling is flexible</strong> - Configure retries, timeouts, and failure strategies per-step or globally</p>
</li>
<li>
<p><strong>Sessions are resumable</strong> - Interrupted recipes can continue from where they left off</p>
</li>
<li>
<p><strong>Validation prevents surprises</strong> - Check recipe structure before execution to catch errors early</p>
</li>
</ol>
<p>Recipes transform ad-hoc agent orchestration into reproducible, auditable processes. Start simple with flat recipes, add stages and approvals as workflows mature, and leverage context flow to build sophisticated multi-agent pipelines.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="agents.html" class="btn btn-neutral float-left" title="Agents"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="skills.html" class="btn btn-neutral float-right" title="Skills">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="agents.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="skills.html" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
